{"version":3,"file":"badges.min.js","sources":["../src/badges.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to badges manage.\n *\n * @module    block/ludifica\n * @copyright 2021 David Herney @ BambuCo\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery',\n        'core/notification',\n        'core/str',\n        'core/ajax',\n        'block_ludifica/alertc',\n        'block_ludifica/player',\n        'core/modal_factory',\n        'core/log',\n        'core/templates'],\nfunction($,\n        Notification,\n        Str,\n        Ajax,\n        Alertc,\n        Player,\n        ModalFactory,\n        Log,\n        Templates) {\n\n\n    // Load used strings.\n    var strings = [\n        {key: 'badgelinkcopiedtoclipboard', component: 'block_ludifica'}\n    ];\n\n    var s = [];\n\n    strings.forEach(function(one) {\n        s[one.key] = one.key;\n    });\n\n    Str.get_strings(strings).then(function(results) {\n        results.forEach(function(value, index) {\n            s[strings[index].key] = value;\n        });\n\n        return true;\n    }).\n    fail(function(e) {\n        Log.debug('Error loading strings');\n        Log.debug(e);\n    });\n    // End load used strings.\n\n    /**\n     * Initialise all for badges.\n     *\n     * @param {Array} networks\n     *\n     */\n    var init = function (networks) {\n\n        $('.openshare').on('click', function() {\n            var $content = $('.share_badge_modal');\n            var $title = $content.attr('title');\n\n            var badge = {\n                \"id\": $(this).data('badgeid')\n            };\n\n            var $badge = $('#badge-' + badge.id);\n\n            badge.thumbnail = $badge.find('.thumbnail').attr('src');\n            badge.url = $badge.find('.shareurl').attr('href');\n            badge.name = $badge.data('name');\n            badge.year = $badge.data('year');\n            badge.month = $badge.data('month');\n            badge.uniquehash = $badge.data('uniquehash');\n\n            var badgedata = {\n                \"networks\": [],\n                \"thumbnailurl\": badge.thumbnail,\n                \"badge\": badge\n            };\n\n            networks.forEach(network => {\n                let networkurl = network.url;\n                // Change the \"=\" for the standard URL code.\n                let badgeencode = badge.url.replace(/[=]/g, '%3d');\n\n                networkurl = networkurl.replace(/{name}/gi, encodeURI(badge.name));\n                networkurl = networkurl.replace(/{url}/gi, badgeencode);\n                networkurl = networkurl.replace(/{badgeyear}/gi, badge.year);\n                networkurl = networkurl.replace(/{badgemonth}/gi, badge.month);\n                networkurl = networkurl.replace(/{badgeid}/gi, badge.uniquehash);\n\n                badgedata.networks[badgedata.networks.length] = {\n                    \"url\": networkurl,\n                    \"icon\": network.icon,\n                    \"iconsource\": \"core\",\n                    \"name\": network.icon\n                };\n            });\n\n            ModalFactory.create({\n                title: $title,\n                body: Templates.render('block_ludifica/sharebadge', badgedata),\n            }).then(function(modal) {\n                return modal.show().then(function() {\n                    $('input[name=\"badgelink\"]').on('click', function() {\n                        var $input = $(this);\n                        $input.select();\n                        document.execCommand(\"copy\");\n\n                        var $msg = $('<div class=\"msg-badgelink-copy\">' + s.badgelinkcopiedtoclipboard + '</div>');\n\n                        $input.parent().append($msg);\n                        window.setTimeout(function() {\n                            $msg.remove();\n                        }, 1600);\n                    });\n                    return true;\n                });\n            }).fail(function(e) {\n                Log.debug('Error creating modal share buttons');\n                Log.debug(e);\n            });\n            return true;\n        });\n    };\n\n    return {\n        init: init\n    };\n\n});"],"names":["define","$","Notification","Str","Ajax","Alertc","Player","ModalFactory","Log","Templates","strings","key","component","s","forEach","one","get_strings","then","results","value","index","fail","e","debug","init","networks","on","$title","attr","badge","this","data","$badge","id","thumbnail","find","url","name","year","month","uniquehash","badgedata","network","networkurl","badgeencode","replace","encodeURI","length","icon","create","title","body","render","modal","show","$input","select","document","execCommand","$msg","badgelinkcopiedtoclipboard","parent","append","window","setTimeout","remove"],"mappings":";;;;;;;AAuBAA,+BAAO,CAAC,SACA,oBACA,WACA,YACA,wBACA,wBACA,qBACA,WACA,mBACR,SAASC,EACDC,aACAC,IACAC,KACAC,OACAC,OACAC,aACAC,IACAC,eAIAC,QAAU,CACV,CAACC,IAAK,6BAA8BC,UAAW,mBAG/CC,EAAI,GAERH,QAAQI,SAAQ,SAASC,KACrBF,EAAEE,IAAIJ,KAAOI,IAAIJ,OAGrBR,IAAIa,YAAYN,SAASO,MAAK,SAASC,gBACnCA,QAAQJ,SAAQ,SAASK,MAAOC,OAC5BP,EAAEH,QAAQU,OAAOT,KAAOQ,UAGrB,KAEXE,MAAK,SAASC,GACVd,IAAIe,MAAM,yBACVf,IAAIe,MAAMD,YAiFP,CACHE,KAxEO,SAAUC,UAEjBxB,EAAE,cAAcyB,GAAG,SAAS,eAEpBC,OADW1B,EAAE,sBACK2B,KAAK,SAEvBC,MAAQ,IACF5B,EAAE6B,MAAMC,KAAK,YAGnBC,OAAS/B,EAAE,UAAY4B,MAAMI,IAEjCJ,MAAMK,UAAYF,OAAOG,KAAK,cAAcP,KAAK,OACjDC,MAAMO,IAAMJ,OAAOG,KAAK,aAAaP,KAAK,QAC1CC,MAAMQ,KAAOL,OAAOD,KAAK,QACzBF,MAAMS,KAAON,OAAOD,KAAK,QACzBF,MAAMU,MAAQP,OAAOD,KAAK,SAC1BF,MAAMW,WAAaR,OAAOD,KAAK,kBAE3BU,UAAY,UACA,gBACIZ,MAAMK,gBACbL,cAGbJ,SAASX,SAAQ,SAAA4B,aACTC,WAAaD,QAAQN,IAErBQ,YAAcf,MAAMO,IAAIS,QAAQ,OAAQ,OAM5CF,YADAA,YADAA,YADAA,YADAA,WAAaA,WAAWE,QAAQ,WAAYC,UAAUjB,MAAMQ,QACpCQ,QAAQ,UAAWD,cACnBC,QAAQ,gBAAiBhB,MAAMS,OAC/BO,QAAQ,iBAAkBhB,MAAMU,QAChCM,QAAQ,cAAehB,MAAMW,YAErDC,UAAUhB,SAASgB,UAAUhB,SAASsB,QAAU,KACrCJ,gBACCD,QAAQM,gBACF,YACNN,QAAQM,SAIxBzC,aAAa0C,OAAO,CAChBC,MAAOvB,OACPwB,KAAM1C,UAAU2C,OAAO,4BAA6BX,aACrDxB,MAAK,SAASoC,cACNA,MAAMC,OAAOrC,MAAK,kBACrBhB,EAAE,2BAA2ByB,GAAG,SAAS,eACjC6B,OAAStD,EAAE6B,MACfyB,OAAOC,SACPC,SAASC,YAAY,YAEjBC,KAAO1D,EAAE,mCAAqCY,EAAE+C,2BAA6B,UAEjFL,OAAOM,SAASC,OAAOH,MACvBI,OAAOC,YAAW,WACdL,KAAKM,WACN,UAEA,QAEZ5C,MAAK,SAASC,GACbd,IAAIe,MAAM,sCACVf,IAAIe,MAAMD,OAEP"}
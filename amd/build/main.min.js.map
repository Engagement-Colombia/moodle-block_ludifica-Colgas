{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the block.\n *\n * @module    block/ludifica\n * @copyright 2021 David Herney @ BambuCo\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/str', 'core/modal_factory', 'block_ludifica/alertc', 'core/log'],\nfunction($, str, ModalFactory, Alertc, Log) {\n\n    // Load strings.\n    var strings = [];\n    strings.push({key: 'badgelinkcopiedtoclipboard', component: 'block_ludifica'});\n\n    var s = [];\n\n    if (strings.length > 0) {\n\n        strings.forEach(one => {\n            s[one.key] = one.key;\n        });\n\n        str.get_strings(strings).then(function(results) {\n            var pos = 0;\n            strings.forEach(one => {\n                s[one.key] = results[pos];\n                pos++;\n            });\n            return true;\n        }).fail(function(e) {\n            Log.debug('Error loading strings');\n            Log.debug(e);\n        });\n    }\n    // End of Load strings.\n\n    // Based in https://philipwalton.com/articles/responsive-components-a-solution-to-the-container-queries-problem/\n    var resizeobserver = function() {\n\n        // Find all elements with the `data-observe-resizes` attribute\n        // and start observing them.\n        $('[data-observe-resizes]').each(function() {\n\n            // Only run if ResizeObserver is supported.\n            if ('ResizeObserver' in self) {\n                // Create a single ResizeObserver instance to handle all\n                // container elements. The instance is created with a callback,\n                // which is invoked as soon as an element is observed as well\n                // as any time that element's size changes.\n                let ro = new ResizeObserver(function(entries) {\n\n                    // Default breakpoints that should apply to all observed\n                    // elements that don't define their own custom breakpoints.\n                    var defaultBreakpoints = {XS: 0, SM: 384, MD: 576, LG: 768, XL: 960};\n\n                    entries.forEach(function(entry) {\n\n                        // If breakpoints are defined on the observed element,\n                        // use them. Otherwise use the defaults.\n                        var breakpoints = entry.target.dataset.breakpoints ?\n                            JSON.parse(entry.target.dataset.breakpoints) :\n                            defaultBreakpoints;\n\n                        // Update the matching breakpoints on the observed element.\n                        Object.keys(breakpoints).forEach(function(breakpoint) {\n                            var minWidth = breakpoints[breakpoint];\n                            if (entry.contentRect.width >= minWidth) {\n                                entry.target.classList.add(breakpoint);\n                            } else {\n                                entry.target.classList.remove(breakpoint);\n                            }\n                        });\n                    });\n                });\n\n                ro.observe(this);\n            }\n        });\n    };\n\n    /**\n     * Initialise all for the block.\n     *\n     */\n    var init = function() {\n\n        // Load default controls.\n\n        // Modal.\n        $('.block_ludifica-modal').each(function() {\n            var $element = $(this);\n            var title = $element.attr('title');\n            var props = {\n                title: title || '',\n                body: $element.html()\n            };\n\n            if ($element.find('footer').length > 0) {\n                props.footer = $element.find('footer');\n            }\n\n            if ($element.data('type')) {\n                props.type = $element.data('type');\n            }\n\n            ModalFactory.create(props, $('.block_ludifica-modalcontroller[data-ref-id=\"' + $element.attr('id') + '\"]'));\n        });\n\n        $('.block_ludifica-content').each(function() {\n\n            var $blockcontent = $(this);\n\n            // Tabs.\n            $blockcontent.find('.block_ludifica-tabs').each(function() {\n                var $tabs = $(this);\n                var tabslist = [];\n\n                $tabs.find('[data-ref]').each(function() {\n                    var $tab = $(this);\n                    tabslist.push($tab);\n\n                    $tab.on('click', function() {\n                        tabslist.forEach(one => {\n                            $(one.data('ref')).removeClass('active');\n                        });\n\n                        $tabs.find('.active[data-ref]').removeClass('active');\n\n                        $tab.addClass('active');\n                        $($tab.data('ref')).addClass('active');\n                    });\n                });\n\n                // Load dynamic buttons.\n                $blockcontent.find('[ludifica-tab]').each(function() {\n                    var $button = $(this);\n\n                    $button.on('click', function() {\n                        var key = '.tab-' + $button.attr('ludifica-tab');\n\n                        tabslist.forEach($tab => {\n                            if ($tab.data('ref').indexOf(key) >= 0) {\n                                $tab.trigger('click');\n                            }\n                        });\n                    });\n                });\n\n            });\n        });\n\n        $('body').on('updatefailed', '[data-inplaceeditable]', function(e) {\n            var exception = e.exception; // The exception object returned by the callback.\n            e.preventDefault(); // This will prevent default error dialogue.\n\n            if (exception.errorcode == \"nicknameexists\") {\n                Alertc.error(exception.message);\n\n                // Cleared the error code because the event is twice called.\n                exception.errorcode = null;\n            }\n        });\n\n        resizeobserver();\n\n    };\n\n    return {\n        init: init\n    };\n\n});\n\n"],"names":["define","$","str","ModalFactory","Alertc","Log","strings","push","key","component","s","length","forEach","one","get_strings","then","results","pos","fail","e","debug","init","each","$element","this","props","title","attr","body","html","find","footer","data","type","create","$blockcontent","$tabs","tabslist","$tab","on","removeClass","addClass","$button","indexOf","trigger","exception","preventDefault","errorcode","error","message","self","ResizeObserver","entries","defaultBreakpoints","XS","SM","MD","LG","XL","entry","breakpoints","target","dataset","JSON","parse","Object","keys","breakpoint","minWidth","contentRect","width","classList","add","remove","observe"],"mappings":";;;;;;;AAuBAA,6BAAO,CAAC,SAAU,WAAY,qBAAsB,wBAAyB,aAC7E,SAASC,EAAGC,IAAKC,aAAcC,OAAQC,SAG/BC,QAAU,GACdA,QAAQC,KAAK,CAACC,IAAK,6BAA8BC,UAAW,uBAExDC,EAAI,GAEJJ,QAAQK,OAAS,IAEjBL,QAAQM,SAAQC,MACZH,EAAEG,IAAIL,KAAOK,IAAIL,OAGrBN,IAAIY,YAAYR,SAASS,MAAK,SAASC,aAC/BC,IAAM,SACVX,QAAQM,SAAQC,MACZH,EAAEG,IAAIL,KAAOQ,QAAQC,KACrBA,UAEG,KACRC,MAAK,SAASC,GACbd,IAAIe,MAAM,yBACVf,IAAIe,MAAMD,aAwIX,CACHE,KApFO,WAKPpB,EAAE,yBAAyBqB,MAAK,eACxBC,SAAWtB,EAAEuB,MAEbC,MAAQ,CACRC,MAFQH,SAASI,KAAK,UAEN,GAChBC,KAAML,SAASM,QAGfN,SAASO,KAAK,UAAUnB,OAAS,IACjCc,MAAMM,OAASR,SAASO,KAAK,WAG7BP,SAASS,KAAK,UACdP,MAAMQ,KAAOV,SAASS,KAAK,SAG/B7B,aAAa+B,OAAOT,MAAOxB,EAAE,gDAAkDsB,SAASI,KAAK,MAAQ,UAGzG1B,EAAE,2BAA2BqB,MAAK,eAE1Ba,cAAgBlC,EAAEuB,MAGtBW,cAAcL,KAAK,wBAAwBR,MAAK,eACxCc,MAAQnC,EAAEuB,MACVa,SAAW,GAEfD,MAAMN,KAAK,cAAcR,MAAK,eACtBgB,KAAOrC,EAAEuB,MACba,SAAS9B,KAAK+B,MAEdA,KAAKC,GAAG,SAAS,WACbF,SAASzB,SAAQC,MACbZ,EAAEY,IAAImB,KAAK,QAAQQ,YAAY,aAGnCJ,MAAMN,KAAK,qBAAqBU,YAAY,UAE5CF,KAAKG,SAAS,UACdxC,EAAEqC,KAAKN,KAAK,QAAQS,SAAS,gBAKrCN,cAAcL,KAAK,kBAAkBR,MAAK,eAClCoB,QAAUzC,EAAEuB,MAEhBkB,QAAQH,GAAG,SAAS,eACZ/B,IAAM,QAAUkC,QAAQf,KAAK,gBAEjCU,SAASzB,SAAQ0B,OACTA,KAAKN,KAAK,OAAOW,QAAQnC,MAAQ,GACjC8B,KAAKM,QAAQ,wBASrC3C,EAAE,QAAQsC,GAAG,eAAgB,0BAA0B,SAASpB,OACxD0B,UAAY1B,EAAE0B,UAClB1B,EAAE2B,iBAEyB,kBAAvBD,UAAUE,YACV3C,OAAO4C,MAAMH,UAAUI,SAGvBJ,UAAUE,UAAY,SAtH9B9C,EAAE,0BAA0BqB,MAAK,WAGzB,mBAAoB4B,MAKX,IAAIC,gBAAe,SAASC,aAI7BC,mBAAqB,CAACC,GAAI,EAAGC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,KAEhEN,QAAQxC,SAAQ,SAAS+C,WAIjBC,YAAcD,MAAME,OAAOC,QAAQF,YACnCG,KAAKC,MAAML,MAAME,OAAOC,QAAQF,aAChCP,mBAGJY,OAAOC,KAAKN,aAAahD,SAAQ,SAASuD,gBAClCC,SAAWR,YAAYO,YACvBR,MAAMU,YAAYC,OAASF,SAC3BT,MAAME,OAAOU,UAAUC,IAAIL,YAE3BR,MAAME,OAAOU,UAAUE,OAAON,qBAM3CO,QAAQlD"}
{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the block.\n *\n * @module    block/ludifica\n * @copyright 2021 David Herney @ BambuCo\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/str', 'core/modal_factory', 'block_ludifica/alertc', 'core/log', 'core/ajax'],\nfunction($, str, ModalFactory, Alertc, Log/* , Ajax */) {\n\n    // Load strings.\n    var strings = [];\n    strings.push({key: 'badgelinkcopiedtoclipboard', component: 'block_ludifica'});\n\n    var s = [];\n\n    if (strings.length > 0) {\n\n        strings.forEach(one => {\n            s[one.key] = one.key;\n        });\n\n        str.get_strings(strings).then(function(results) {\n            var pos = 0;\n            strings.forEach(one => {\n                s[one.key] = results[pos];\n                pos++;\n            });\n            return true;\n        }).fail(function(e) {\n            Log.debug('Error loading strings');\n            Log.debug(e);\n        });\n    }\n    // End of Load strings.\n\n    // Based in https://philipwalton.com/articles/responsive-components-a-solution-to-the-container-queries-problem/\n    var resizeobserver = function() {\n\n        // Find all elements with the `data-observe-resizes` attribute\n        // and start observing them.\n        $('[data-observe-resizes]').each(function() {\n\n            // Only run if ResizeObserver is supported.\n            if ('ResizeObserver' in self) {\n                // Create a single ResizeObserver instance to handle all\n                // container elements. The instance is created with a callback,\n                // which is invoked as soon as an element is observed as well\n                // as any time that element's size changes.\n                let ro = new ResizeObserver(function(entries) {\n\n                    // Default breakpoints that should apply to all observed\n                    // elements that don't define their own custom breakpoints.\n                    var defaultBreakpoints = {XS: 0, SM: 384, MD: 576, LG: 768, XL: 960};\n\n                    entries.forEach(function(entry) {\n\n                        // If breakpoints are defined on the observed element,\n                        // use them. Otherwise use the defaults.\n                        var breakpoints = entry.target.dataset.breakpoints ?\n                            JSON.parse(entry.target.dataset.breakpoints) :\n                            defaultBreakpoints;\n\n                        // Update the matching breakpoints on the observed element.\n                        Object.keys(breakpoints).forEach(function(breakpoint) {\n                            var minWidth = breakpoints[breakpoint];\n                            if (entry.contentRect.width >= minWidth) {\n                                entry.target.classList.add(breakpoint);\n                            } else {\n                                entry.target.classList.remove(breakpoint);\n                            }\n                        });\n                    });\n                });\n\n                ro.observe(this);\n            }\n        });\n    };\n\n    /**\n     * Initialise all for the block.\n     *\n     */\n    var init = function() {\n\n        // Load default controls.\n\n        // Modal.\n        $('.block_ludifica-modal').each(function() {\n            var $element = $(this);\n            var title = $element.attr('title');\n            var props = {\n                title: title || '',\n                body: $element.html()\n            };\n\n            if ($element.find('footer').length > 0) {\n                props.footer = $element.find('footer');\n            }\n\n            if ($element.data('type')) {\n                props.type = $element.data('type');\n            }\n\n            ModalFactory.create(props, $('.block_ludifica-modalcontroller[data-ref-id=\"' + $element.attr('id') + '\"]'));\n        });\n\n        // Tabs.\n        $('.block_ludifica-tabs').each(function() {\n            var $tabs = $(this);\n            var tabslist = [];\n\n            $tabs.find('[data-ref]').each(function() {\n                var $tab = $(this);\n                tabslist.push($tab);\n\n                $tab.on('click', function() {\n                    tabslist.forEach(one => {\n                        $(one.data('ref')).removeClass('active');\n                    });\n\n                    $tabs.find('.active[data-ref]').removeClass('active');\n\n                    $tab.addClass('active');\n                    $($tab.data('ref')).addClass('active');\n                });\n\n            });\n\n        });\n\n        $('body').on('updatefailed', '[data-inplaceeditable]', function(e) {\n            var exception = e.exception; // The exception object returned by the callback.\n            e.preventDefault(); // This will prevent default error dialogue.\n\n            if (exception.errorcode == \"nicknameexists\") {\n                Alertc.error(exception.message);\n\n                // Cleared the error code because the event is twice called.\n                exception.errorcode = null;\n            }\n        });\n\n        // Share badge buttons.\n/*         Ajax.call([{\n            methodname: 'block_ludifica_get_badge_info',\n            done: function() {\n\n            },\n            fail: function(e) {\n                Alertc.error(e.message);\n                Log.debug(e);\n            }\n        }]); */\n\n        $('.openshare').on('click', function() {\n            var $content = $('.share_badge_modal');\n            var $title = $content.attr('title');\n\n            ModalFactory.create({\n                title: $title,\n                body: $content.html(),\n            }).then(function(modal) {\n                return modal.show().then(function() {\n                    $('input[name=\"badgelink\"]').on('click', function() {\n                        var $input = $(this);\n                        $input.select();\n                        document.execCommand(\"copy\");\n\n                        var $msg = $('<div class=\"msg-badgelink-copy\">' + s.badgelinkcopiedtoclipboard + '</div>');\n\n                        $input.parent().append($msg);\n                        window.setTimeout(function() {\n                            $msg.remove();\n                        }, 1600);\n                    });\n                    return true;\n                });\n            }).fail(function(e) {\n                Log.debug('Error creating modal share buttons');\n                Log.debug(e);\n            });\n            return true;\n        });\n        // End of share badge buttons.\n\n        resizeobserver();\n\n    };\n\n    return {\n        init: init\n    };\n\n});\n\n"],"names":["define","$","str","ModalFactory","Alertc","Log","strings","push","key","component","s","length","forEach","one","get_strings","then","results","pos","fail","e","debug","init","each","$element","this","props","title","attr","body","html","find","footer","data","type","create","$tabs","tabslist","$tab","on","removeClass","addClass","exception","preventDefault","errorcode","error","message","$content","$title","modal","show","$input","select","document","execCommand","$msg","badgelinkcopiedtoclipboard","parent","append","window","setTimeout","remove","self","ResizeObserver","entries","defaultBreakpoints","XS","SM","MD","LG","XL","entry","breakpoints","target","dataset","JSON","parse","Object","keys","breakpoint","minWidth","contentRect","width","classList","add","observe"],"mappings":";;;;;;;AAuBAA,6BAAO,CAAC,SAAU,WAAY,qBAAsB,wBAAyB,WAAY,cACzF,SAASC,EAAGC,IAAKC,aAAcC,OAAQC,SAG/BC,QAAU,GACdA,QAAQC,KAAK,CAACC,IAAK,6BAA8BC,UAAW,uBAExDC,EAAI,GAEJJ,QAAQK,OAAS,IAEjBL,QAAQM,SAAQ,SAAAC,KACZH,EAAEG,IAAIL,KAAOK,IAAIL,OAGrBN,IAAIY,YAAYR,SAASS,MAAK,SAASC,aAC/BC,IAAM,SACVX,QAAQM,SAAQ,SAAAC,KACZH,EAAEG,IAAIL,KAAOQ,QAAQC,KACrBA,UAEG,KACRC,MAAK,SAASC,GACbd,IAAIe,MAAM,yBACVf,IAAIe,MAAMD,aAgKX,CACHE,KA5GO,WAKPpB,EAAE,yBAAyBqB,MAAK,eACxBC,SAAWtB,EAAEuB,MAEbC,MAAQ,CACRC,MAFQH,SAASI,KAAK,UAEN,GAChBC,KAAML,SAASM,QAGfN,SAASO,KAAK,UAAUnB,OAAS,IACjCc,MAAMM,OAASR,SAASO,KAAK,WAG7BP,SAASS,KAAK,UACdP,MAAMQ,KAAOV,SAASS,KAAK,SAG/B7B,aAAa+B,OAAOT,MAAOxB,EAAE,gDAAkDsB,SAASI,KAAK,MAAQ,UAIzG1B,EAAE,wBAAwBqB,MAAK,eACvBa,MAAQlC,EAAEuB,MACVY,SAAW,GAEfD,MAAML,KAAK,cAAcR,MAAK,eACtBe,KAAOpC,EAAEuB,MACbY,SAAS7B,KAAK8B,MAEdA,KAAKC,GAAG,SAAS,WACbF,SAASxB,SAAQ,SAAAC,KACbZ,EAAEY,IAAImB,KAAK,QAAQO,YAAY,aAGnCJ,MAAML,KAAK,qBAAqBS,YAAY,UAE5CF,KAAKG,SAAS,UACdvC,EAAEoC,KAAKL,KAAK,QAAQQ,SAAS,mBAOzCvC,EAAE,QAAQqC,GAAG,eAAgB,0BAA0B,SAASnB,OACxDsB,UAAYtB,EAAEsB,UAClBtB,EAAEuB,iBAEyB,kBAAvBD,UAAUE,YACVvC,OAAOwC,MAAMH,UAAUI,SAGvBJ,UAAUE,UAAY,SAgB9B1C,EAAE,cAAcqC,GAAG,SAAS,eACpBQ,SAAW7C,EAAE,sBACb8C,OAASD,SAASnB,KAAK,gBAE3BxB,aAAa+B,OAAO,CAChBR,MAAOqB,OACPnB,KAAMkB,SAASjB,SAChBd,MAAK,SAASiC,cACNA,MAAMC,OAAOlC,MAAK,kBACrBd,EAAE,2BAA2BqC,GAAG,SAAS,eACjCY,OAASjD,EAAEuB,MACf0B,OAAOC,SACPC,SAASC,YAAY,YAEjBC,KAAOrD,EAAE,mCAAqCS,EAAE6C,2BAA6B,UAEjFL,OAAOM,SAASC,OAAOH,MACvBI,OAAOC,YAAW,WACdL,KAAKM,WACN,UAEA,QAEZ1C,MAAK,SAASC,GACbd,IAAIe,MAAM,sCACVf,IAAIe,MAAMD,OAEP,KA9IXlB,EAAE,0BAA0BqB,MAAK,WAGzB,mBAAoBuC,MAKX,IAAIC,gBAAe,SAASC,aAI7BC,mBAAqB,CAACC,GAAI,EAAGC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,KAEhEN,QAAQnD,SAAQ,SAAS0D,WAIjBC,YAAcD,MAAME,OAAOC,QAAQF,YACnCG,KAAKC,MAAML,MAAME,OAAOC,QAAQF,aAChCP,mBAGJY,OAAOC,KAAKN,aAAa3D,SAAQ,SAASkE,gBAClCC,SAAWR,YAAYO,YACvBR,MAAMU,YAAYC,OAASF,SAC3BT,MAAME,OAAOU,UAAUC,IAAIL,YAE3BR,MAAME,OAAOU,UAAUtB,OAAOkB,qBAM3CM,QAAQ5D"}
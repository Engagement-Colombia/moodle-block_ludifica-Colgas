{"version":3,"file":"avatars.min.js","sources":["../src/avatars.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to avatars manage.\n *\n * @module    block/ludifica\n * @copyright 2021 David Herney @ BambuCo\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/notification', 'core/str', 'core/ajax', 'block_ludifica/alertc', 'block_ludifica/player', 'core/log'],\nfunction($, Notification, Str, Ajax, Alertc, Player, Log) {\n\n    var s = [];\n\n    /**\n     * Initialise all for avatars.\n     *\n     */\n    var init = function() {\n\n        // Load used strings.\n        var strings = [\n            {key: 'avatarbuy', component: 'block_ludifica'},\n            {key: 'avatarbuymessage', component: 'block_ludifica'},\n            {key: 'buy', component: 'block_ludifica'},\n            {key: 'notbuy', component: 'block_ludifica'},\n            {key: 'bought', component: 'block_ludifica'},\n            {key: 'avataruse', component: 'block_ludifica'},\n            {key: 'avatarusemessage', component: 'block_ludifica'},\n            {key: 'use', component: 'block_ludifica'},\n            {key: 'avatarnotuse', component: 'block_ludifica'},\n            {key: 'avatarused', component: 'block_ludifica'},\n            {key: 'cancel'},\n            {key: 'continue'},\n            {key: 'error'},\n            {key: 'info'},\n        ];\n        strings.forEach(function(one) {\n            s[one.key] = one.key;\n        });\n\n        Str.get_strings(strings).then(function(results) {\n            results.forEach(function(value, index) {\n                s[strings[index].key] = value;\n            });\n\n            return true;\n        }).\n        fail(function(e) {\n            Log.debug('Error get strings');\n            Log.debug(e);\n        });\n        // End load used strings.\n\n        // Buy.\n        $('[data-action=\"buy\"]').on('click', function() {\n            var $element = $(this);\n            var avatarid = $element.data('id');\n\n            Notification.confirm(s.avatarbuy, s.avatarbuymessage, s.buy, s.cancel, function() {\n\n                // Buy the avatar.\n                Ajax.call([{\n                    methodname: 'block_ludifica_buy_avatar',\n                    args: {'id': avatarid},\n                    done: function(data) {\n\n                        if (data) {\n                            Alertc.success(s.bought);\n                            var $avatarbox = $('#avatar-' + avatarid);\n                            $avatarbox.removeClass('usernothas');\n                            $avatarbox.addClass('userhas');\n                            Player.reloadStats();\n                        } else {\n                            Alertc.error(s.notbuy);\n                        }\n\n                    },\n                    fail: function(e) {\n                        Log.debug('Error buy avatar');\n                        Log.debug(e);\n                    }\n                }]);\n\n            });\n\n        });\n\n        // Buy.\n        $('[data-action=\"use\"]').on('click', function() {\n            var $element = $(this);\n            var avatarid = $element.data('id');\n\n            Notification.confirm(s.avataruse, s.avatarusemessage, s.use, s.cancel, function() {\n\n                // Select the avatar.\n                Ajax.call([{\n                    methodname: 'block_ludifica_use_avatar',\n                    args: {'id': avatarid},\n                    done: function(data) {\n\n                        if (data) {\n                            Alertc.success(s.avatarused);\n                            $('.oneavatar.inuse').removeClass('inuse');\n\n                            var $avatarbox = $('#avatar-' + avatarid);\n                            $avatarbox.addClass('inuse');\n                            Log.debug($avatarbox);\n                        } else {\n                            Alertc.error(s.avatarnotuse);\n                        }\n\n                    },\n                    fail: function(e) {\n                        Log.debug('Error assigning avatar');\n                        Log.debug(e);\n                    }\n                }]);\n\n            });\n\n        });\n\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","Notification","Str","Ajax","Alertc","Player","Log","s","init","strings","key","component","forEach","one","get_strings","then","results","value","index","fail","e","debug","on","avatarid","this","data","confirm","avatarbuy","avatarbuymessage","buy","cancel","call","methodname","args","done","success","bought","$avatarbox","removeClass","addClass","reloadStats","error","notbuy","avataruse","avatarusemessage","use","avatarused","avatarnotuse"],"mappings":";;;;;;;AAuBAA,gCAAO,CAAC,SAAU,oBAAqB,WAAY,YAAa,wBAAyB,wBAAyB,aAClH,SAASC,EAAGC,aAAcC,IAAKC,KAAMC,OAAQC,OAAQC,SAE7CC,EAAI,SAiHD,CACHC,KA5GO,eAGHC,QAAU,CACV,CAACC,IAAK,YAAaC,UAAW,kBAC9B,CAACD,IAAK,mBAAoBC,UAAW,kBACrC,CAACD,IAAK,MAAOC,UAAW,kBACxB,CAACD,IAAK,SAAUC,UAAW,kBAC3B,CAACD,IAAK,SAAUC,UAAW,kBAC3B,CAACD,IAAK,YAAaC,UAAW,kBAC9B,CAACD,IAAK,mBAAoBC,UAAW,kBACrC,CAACD,IAAK,MAAOC,UAAW,kBACxB,CAACD,IAAK,eAAgBC,UAAW,kBACjC,CAACD,IAAK,aAAcC,UAAW,kBAC/B,CAACD,IAAK,UACN,CAACA,IAAK,YACN,CAACA,IAAK,SACN,CAACA,IAAK,SAEVD,QAAQG,SAAQ,SAASC,KACrBN,EAAEM,IAAIH,KAAOG,IAAIH,OAGrBR,IAAIY,YAAYL,SAASM,MAAK,SAASC,gBACnCA,QAAQJ,SAAQ,SAASK,MAAOC,OAC5BX,EAAEE,QAAQS,OAAOR,KAAOO,UAGrB,KAEXE,MAAK,SAASC,GACVd,IAAIe,MAAM,qBACVf,IAAIe,MAAMD,MAKdpB,EAAE,uBAAuBsB,GAAG,SAAS,eAE7BC,SADWvB,EAAEwB,MACOC,KAAK,MAE7BxB,aAAayB,QAAQnB,EAAEoB,UAAWpB,EAAEqB,iBAAkBrB,EAAEsB,IAAKtB,EAAEuB,QAAQ,WAGnE3B,KAAK4B,KAAK,CAAC,CACPC,WAAY,4BACZC,KAAM,IAAOV,UACbW,KAAM,SAAST,SAEPA,KAAM,CACNrB,OAAO+B,QAAQ5B,EAAE6B,YACbC,WAAarC,EAAE,WAAauB,UAChCc,WAAWC,YAAY,cACvBD,WAAWE,SAAS,WACpBlC,OAAOmC,mBAEPpC,OAAOqC,MAAMlC,EAAEmC,SAIvBvB,KAAM,SAASC,GACXd,IAAIe,MAAM,oBACVf,IAAIe,MAAMD,aAS1BpB,EAAE,uBAAuBsB,GAAG,SAAS,eAE7BC,SADWvB,EAAEwB,MACOC,KAAK,MAE7BxB,aAAayB,QAAQnB,EAAEoC,UAAWpC,EAAEqC,iBAAkBrC,EAAEsC,IAAKtC,EAAEuB,QAAQ,WAGnE3B,KAAK4B,KAAK,CAAC,CACPC,WAAY,4BACZC,KAAM,IAAOV,UACbW,KAAM,SAAST,SAEPA,KAAM,CACNrB,OAAO+B,QAAQ5B,EAAEuC,YACjB9C,EAAE,oBAAoBsC,YAAY,aAE9BD,WAAarC,EAAE,WAAauB,UAChCc,WAAWE,SAAS,SACpBjC,IAAIe,MAAMgB,iBAEVjC,OAAOqC,MAAMlC,EAAEwC,eAIvB5B,KAAM,SAASC,GACXd,IAAIe,MAAM,0BACVf,IAAIe,MAAMD"}